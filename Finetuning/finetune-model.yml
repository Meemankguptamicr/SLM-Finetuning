#define the job to train the model
$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json
type: command

name: finetune_model
display_name: Finetune Model

command: >
  python -m torch.distributed.run finetune.py
  --train-file ${{inputs.train_file}}
  --test-file ${{inputs.test_file}}
  --base-model-id ${{inputs.base_model_id}}
  --model-version ${{inputs.model_version}}
  --model-dir ${{outputs.model_dir}}

# Define the inputs section
inputs:
  train_file:
    type: uri_file
  test_file:
    type: uri_file
  base_model_id:
    type: string
  model_version:
    type: string
    
outputs:
  model_dir: 
    type: uri_folder
    
code: ./src
distribution:
  type: pytorch
  process_count_per_instance: 1
resources:
  instance_count: 1
environment: azureml:msft-raft-finetuning-env@latest